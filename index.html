<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ClassicFlix</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CRITICAL: Global Error Handler (Must be first script) -->
    <script>
      // 1. Polyfill process for libraries that expect it
      window.process = { env: { NODE_ENV: 'development' } };

      // 2. Error Display Logic
      function showCriticalError(title, detail) {
        // Stop other scripts if possible
        window.stop();
        
        const errorHtml = `
          <div style="position:fixed;top:0;left:0;width:100%;height:100%;background:#141414;color:white;z-index:99999;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;padding:20px;font-family:sans-serif;">
            <h1 style="color:#e50914;margin-bottom:20px;font-size:24px;">${title}</h1>
            <p style="color:#ccc;margin-bottom:20px;max-width:500px;">The application failed to load critical resources. This is likely a network issue or a browser compatibility problem.</p>
            <div style="background:#000;padding:15px;text-align:left;border-radius:4px;max-width:80%;width:600px;overflow:auto;border:1px solid #333;margin-bottom:20px;font-family:monospace;font-size:12px;color:#ff6b6b;">
              ${detail}
            </div>
            <button onclick="window.location.reload()" style="padding:12px 24px;background:#e50914;color:white;border:none;border-radius:4px;cursor:pointer;font-weight:bold;font-size:16px;">Reload Page</button>
          </div>
        `;
        
        // Write directly to body (handles cases where React root doesn't exist yet)
        document.body ? (document.body.innerHTML = errorHtml) : (document.documentElement.innerHTML = '<body>' + errorHtml + '</body>');
      }

      // 3. Catch Synchronous & Syntax Errors
      window.onerror = function(message, source, lineno, colno, error) {
        const detail = `Error: ${message}\nSource: ${source}:${lineno}`;
        console.error("Critical Error:", error || message);
        showCriticalError("Application Error", detail);
        return true; // prevent default browser console error
      };

      // 4. Catch Promise Rejections (e.g., Dynamic Import Failures)
      window.onunhandledrejection = function(event) {
        const detail = `Uncaught Promise: ${event.reason ? event.reason.toString() : 'Unknown Reason'}`;
        console.error("Unhandled Rejection:", event.reason);
        // We only show the full red screen if it looks like a module loading error
        if (event.reason && (event.reason.toString().includes('Failed to fetch') || event.reason.toString().includes('Importing'))) {
             showCriticalError("Loading Error", detail);
        }
      };
    </script>

    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #141414; /* Netflix dark background */
        color: #fff;
        margin: 0;
      }
      .bg-surface { background-color: #1a1a1a; }
      .text-primary-custom { color: #e50914; }
      .bg-primary-custom { background-color: #e50914; }
      
      /* Utilities */
      .movie-card-compact {
        background-color: #1f1f1f;
        border: 1px solid #333;
        transition: all 0.2s ease-in-out;
        cursor: pointer;
        padding: 0.75rem;
        border-radius: 4px;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }
      .movie-card-compact:hover {
        border-color: #e50914;
        background-color: #2a2a2a;
        transform: translateY(-2px);
      }
      
      .movie-card {
        position: relative;
        border-radius: 4px;
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        aspect-ratio: 2/3;
        background-size: cover;
        background-position: center;
        background-color: #1f1f1f;
        border: 1px solid #333;
      }
      .movie-card:hover {
        transform: scale(1.05);
        box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        z-index: 10;
        border-color: #e50914;
      }
      .movie-card-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.95), rgba(0,0,0,0.5), transparent);
        padding: 1rem;
        opacity: 0;
        transition: opacity 0.2s;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
      }
      .movie-card:hover .movie-card-overlay {
        opacity: 1;
      }

      .modal-hero {
        position: relative;
        width: 100%;
        height: 450px;
        background-size: cover;
        background-position: center top;
        border-radius: 8px 8px 0 0;
      }
      .modal-hero::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(to bottom, rgba(24,24,24,0.1) 0%, rgba(24,24,24,1) 100%);
      }
      .modal-hero-content {
        position: absolute;
        bottom: 30px;
        left: 30px;
        z-index: 2;
        width: 90%;
      }

      .custom-scrollbar::-webkit-scrollbar, ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      .custom-scrollbar::-webkit-scrollbar-track, ::-webkit-scrollbar-track {
        background: #141414;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb, ::-webkit-scrollbar-thumb {
        background: #333;
        border-radius: 4px;
      }
      
      .modal-content-custom {
        background-color: #181818;
        border: 1px solid #333;
        border-radius: 8px;
      }
      .text-shadow { text-shadow: 2px 2px 4px rgba(0,0,0,0.8); }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@^19.2.4",
        "react-dom": "https://esm.sh/react-dom@^19.2.4",
        "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
        "react/": "https://esm.sh/react@^19.2.4/",
        "@google/genai": "https://esm.sh/@google/genai@^1.38.0",
        "lucide-react": "https://esm.sh/lucide-react@^0.563.0",
        "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@2.43.2"
      }
    }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Entry point script -->
    <script type="module" src="./index.tsx"></script>
  </body>
</html>